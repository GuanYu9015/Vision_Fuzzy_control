# å½±åƒå¼æ¨¡ç³Šæ§åˆ¶é¿éšœç³»çµ±ï¼ˆçµåˆèªéŸ³æ§åˆ¶ï¼‰

> **Visual Fuzzy Obstacle Avoidance System with Voice Control**  
> åŸºæ–¼ YOLO11 TensorRT å¯¦ä¾‹åˆ†å‰² + BEV é€è¦–è½‰æ› + å››è¼¸å…¥æ¨¡ç³Šé‚è¼¯æ§åˆ¶å™¨ + èªéŸ³æŒ‡ä»¤æ•´åˆçš„æ©Ÿå™¨äººè‡ªä¸»å°èˆªç³»çµ±ã€‚  
> å¹³å°ï¼š**NVIDIA Jetson Orin NX** ãƒ» æ¡†æ¶ï¼š**ROS 1 (Noetic)** ãƒ» å•Ÿå‹•ï¼š`roslaunch yolov7_ros integrated_system.launch`

---

## ç›®éŒ„

1. [ç³»çµ±æ¦‚è¦½](#1-ç³»çµ±æ¦‚è¦½)
2. [æ¶æ§‹èˆ‡è³‡æ–™æµ](#2-æ¶æ§‹èˆ‡è³‡æ–™æµ)
3. [ROS Nodes èˆ‡ Topics](#3-ros-nodes-èˆ‡-topics)
4. [æ¨¡çµ„è©³ç´°èªªæ˜](#4-æ¨¡çµ„è©³ç´°èªªæ˜)
   - 4.1 [é“è·¯æª¢æ¸¬ç¯€é»ï¼ˆYOLO11 + TRTï¼‰](#41-é“è·¯æª¢æ¸¬ç¯€é»yolo11--trt)
   - 4.2 [BEV åº§æ¨™è½‰æ›æ¨¡çµ„](#42-bev-åº§æ¨™è½‰æ›æ¨¡çµ„)
   - 4.3 [æ¨¡ç³Šæ§åˆ¶ç¯€é»](#43-æ¨¡ç³Šæ§åˆ¶ç¯€é»)
   - 4.4 [èªéŸ³æŒ‡ä»¤è™•ç†ç¯€é»](#44-èªéŸ³æŒ‡ä»¤è™•ç†ç¯€é»)
   - 4.5 [æ•´åˆæ§åˆ¶ç¯€é»](#45-æ•´åˆæ§åˆ¶ç¯€é»)
   - 4.6 [è³‡æ–™è¨˜éŒ„ç¯€é»](#46-è³‡æ–™è¨˜éŒ„ç¯€é»)
   - 4.7 [è³‡æºç›£æ§ç¯€é»](#47-è³‡æºç›£æ§ç¯€é»)
5. [æ¨¡ç³Šæ§åˆ¶å™¨è¨­è¨ˆ](#5-æ¨¡ç³Šæ§åˆ¶å™¨è¨­è¨ˆ)
6. [èªéŸ³æŒ‡ä»¤ç·¨ç¢¼ç³»çµ±](#6-èªéŸ³æŒ‡ä»¤ç·¨ç¢¼ç³»çµ±)
7. [ç›¸æ©Ÿåƒæ•¸èˆ‡æ¨™å®š](#7-ç›¸æ©Ÿåƒæ•¸èˆ‡æ¨™å®š)
8. [å®‰è£èˆ‡ä¾è³´](#8-å®‰è£èˆ‡ä¾è³´)
9. [å•Ÿå‹•æ–¹å¼](#9-å•Ÿå‹•æ–¹å¼)
10. [è¼¸å‡ºæª”æ¡ˆçµæ§‹](#10-è¼¸å‡ºæª”æ¡ˆçµæ§‹)
11. [èª¿åƒæŒ‡å¼•](#11-èª¿åƒæŒ‡å¼•)

---

## 1. ç³»çµ±æ¦‚è¦½

æœ¬ç³»çµ±ç‚ºè«–æ–‡ç ”ç©¶å°ˆæ¡ˆï¼ˆNSTCï¼‰ï¼Œæ‡‰ç”¨å ´æ™¯ç‚º**é†«ç™‚ç…§è­·æ©Ÿå™¨äºº**åœ¨èµ°å»Šçš„è‡ªä¸»é¿éšœå°èˆªï¼Œä¸¦æ•´åˆèªéŸ³æ§åˆ¶èƒ½åŠ›ã€‚

| åŠŸèƒ½ | æŠ€è¡“ |
|------|------|
| é“è·¯ï¼ˆèµ°å»Šï¼‰åˆ†å‰² | YOLO11n-seg TensorRTï¼ˆJetson æ¨è«–åŠ é€Ÿï¼‰|
| å¹¾ä½•æ„ŸçŸ¥ | Bird's-Eye Viewï¼ˆBEVï¼‰é€è¦–æŠ•å½±è½‰æ› |
| é¿éšœæ§åˆ¶ | å››è¼¸å…¥æ¨¡ç³Šé‚è¼¯æ§åˆ¶å™¨ï¼ˆFLCï¼‰ï¼Œ625 æ¢è¦å‰‡ |
| èªéŸ³æ§åˆ¶ | VAD + noisereduce é™å™ª + é›²ç«¯ LLM èªéŸ³è¾¨è­˜ï¼ˆNSTC 14.12.19 ç‰ˆæŒ‡ä»¤é›†ï¼‰|
| ç‹€æ…‹ä»²è£ | æ•´åˆæ§åˆ¶å™¨ï¼ˆèªéŸ³å„ªå…ˆ / æ¨¡ç³Šæ¬¡ä¹‹ï¼‰|

---

## 2. æ¶æ§‹èˆ‡è³‡æ–™æµ

```
USB Camera (640Ã—480 @ 30fps)
        â”‚
        â–¼
[road_detection_node]  â† mod_predict_yolo11_trt.py
  YOLO11n-seg TRT
  Letterbox mask è§£ç¢¼               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  BEVTransformer.compute_errors()  â”‚   mod_bev_transform.py       â”‚
  (pixel â†’ å…¬å°ºï¼Œé›™åƒè€ƒé»)         â”‚   camera_config.yaml         â”‚
        â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ /road_info
        â”‚ [road_det, e_d, e_d_dot, e_l, e_l_dot, y_m, x_m]
        â–¼
[fuzzy_controller_node]  â† mod_fuzzy_control4.py
  625 rules (CSV)
  Mamdani min-AND + Weighted Avg defuzz
  EMA ä½é€šæ¿¾æ³¢ (Î±_v=0.2, Î±_Ï‰=0.3)
        â”‚ /fuzzy_cmd_vel (Twist)
        â”‚
[voice_command_node]  â† mod_voice_processing4.py         /voice_command_code
  PyAudio VAD â†’ noisereduce â†’ MP3                              â”‚
  HTTPS to LLM (ngrok tunnel) â†’ inst_codes[ ]  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                                               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
                                                      â–¼        â–¼
                                    [integrated_controller_node]  â† integrated_control4.py
                                     èªéŸ³å„ªå…ˆä»²è£ / 25s timeout ä¿è­·
                                        â”‚ /cmd_vel (Twist)
                                        â–¼
                                     æ©Ÿå™¨äººåº•ç›¤é©…å‹•å™¨

[fuzzy_data_logger]      â† è¨‚é–±æ‰€æœ‰ topicsï¼Œæ¯ 10Hz å¯«å…¥ CSVï¼ˆå¯é¸ï¼‰
[resource_monitor_node]  â† tegrastats ç›£æ§ Jetson è³‡æºï¼ˆå¯é¸ï¼‰
```

---

## 3. ROS Nodes èˆ‡ Topics

### Nodes

| Node åç¨± | è…³æœ¬ | åŸ·è¡Œé »ç‡ | åŠŸèƒ½ |
|-----------|------|---------|------|
| `road_detection_node` | `mod_predict_yolo11_trt.py` | ~30 Hz | YOLO åˆ†å‰² + BEV èª¤å·®è¨ˆç®— |
| `fuzzy_controller_node` | `mod_fuzzy_control4.py` | 10 Hz | å››è¼¸å…¥æ¨¡ç³Šæ¨è«– |
| `voice_command_node` | `mod_voice_processing4.py` | éåŒæ­¥ï¼ˆèªéŸ³è§¸ç™¼ï¼‰| VAD éŒ„éŸ³ã€LLM è¾¨è­˜ã€æŒ‡ä»¤ç™¼å¸ƒ |
| `integrated_controller_node` | `integrated_control4.py` | 10 Hz | èªéŸ³/æ¨¡ç³Šä»²è£ã€æœ€çµ‚é€Ÿåº¦è¼¸å‡º |
| `fuzzy_data_logger` | `fuzzy_data_logger.py` | 10 Hz | å…¨ç³»çµ±è³‡æ–™è¨˜éŒ„ï¼ˆå¯é¸ï¼‰|
| `resource_monitor_node` | `resource_monitor_node.py` | 1 Hz | Jetson tegrastats ç›£æ§ï¼ˆå¯é¸ï¼‰|

### Topics

| Topic | å‹åˆ¥ | ç™¼å¸ƒè€… | èªªæ˜ |
|-------|------|--------|------|
| `/road_info` | `Float32MultiArray` | `road_detection_node` | `[road_detected, e_d, e_d_dot, e_l, e_l_dot, y_ground_m, x_ground_m]` |
| `/fuzzy_cmd_vel` | `geometry_msgs/Twist` | `fuzzy_controller_node` | æ¨¡ç³Šæ¨è«–é€Ÿåº¦è¼¸å‡ºï¼ˆæœªæ¿¾ä»²è£ï¼‰|
| `/voice_command_code` | `String` | `voice_command_node` | 5 ä½æ•¸æŒ‡ä»¤ç¢¼ï¼ˆå¦‚ `11000`ï¼‰|
| `/avoidance_enabled` | `String` | `road_detection_node` / `integrated_controller_node` | `"enabled"` / `"disabled"` |
| `/system_status` | `String` | å¤šç¯€é» | `"voice_command_executing"` / `"fuzzy_control_active"` / `"avoidance_paused"` |
| `/cmd_vel` | `geometry_msgs/Twist` | `integrated_controller_node` | æœ€çµ‚è¼¸å‡ºè‡³åº•ç›¤ |

---

## 4. æ¨¡çµ„è©³ç´°èªªæ˜

### 4.1 é“è·¯æª¢æ¸¬ç¯€é»ï¼ˆYOLO11 + TRTï¼‰

**æª”æ¡ˆï¼š** `scripts/mod_predict_yolo11_trt.py`

**ä¸»è¦æµç¨‹ï¼š**
1. GStreamer / V4L2 é–‹å•Ÿ USB ç›¸æ©Ÿï¼ˆ640Ã—480 @ 30fpsï¼ŒJetson å»ºè­° GStreamerï¼‰
2. YOLO11n-seg TRT æ¨è«–ï¼ˆ`max_det=1`ï¼Œåƒ…å–æœ€é«˜ä¿¡å¿ƒåº¦ç‰©ä»¶ï¼Œ`conf=0.5`ï¼Œ`iou=0.5`ï¼‰
3. Letterbox padding è™•ç†ï¼ˆ640Ã—480 â†’ 640Ã—640 â†’ è£åˆ‡å› 640Ã—480ï¼‰
4. èƒå–**é›™åƒè€ƒé»åƒç´ åº§æ¨™**ï¼ˆè¦‹ä¸‹æ–¹ï¼‰
5. å‘¼å« `BEVTransformer.compute_errors()` è½‰æ›ç‚ºå¯¦éš›è·é›¢èª¤å·®
6. ä»¥ 30Hz ç™¼å¸ƒ `/road_info`ï¼›æŒ‰ `s` åˆ‡æ›é¿éšœã€`q` é€€å‡º

**é›™åƒè€ƒé»ç­–ç•¥ï¼š**

| åƒè€ƒé» | é¡è‰² | è¨ˆç®—æ–¹å¼ | å°æ‡‰èª¤å·® |
|--------|------|---------|---------|
| å‰æ–¹è·é›¢åƒè€ƒé» | ğŸ”µ è— | æ²¿ç•«é¢å‚ç›´ä¸­å¿ƒç·šï¼Œæ‰¾é®ç½©**æœ€é«˜é»**ï¼ˆy æœ€å°ï¼‰ | `e_d`ï¼ˆå‰æ–¹è·é›¢èª¤å·®ï¼‰|
| æ©«å‘èª¤å·®åƒè€ƒé» | ğŸŸ¡ é»ƒ | å›ºå®šåœ¨åœæ­¢è·é›¢å°æ‡‰åƒç´ è¡Œï¼ˆ1.1 m â†’ ç”± BEV é€†ç®— y pixelï¼‰ï¼Œæ‰¾è©²è¡Œé®ç½©ä¸­å¿ƒ | `e_l`ï¼ˆæ©«å‘èª¤å·®ï¼‰|

---

### 4.2 BEV åº§æ¨™è½‰æ›æ¨¡çµ„

**æª”æ¡ˆï¼š** `scripts/mod_bev_transform.py`  
**è¨­å®šï¼š** `config/camera_config.yaml`

**è½‰æ›åŸç†ï¼ˆå¹¾ä½•æŠ•å½±æ³•ï¼‰ï¼š**

```
ç›¸æ©Ÿå®‰è£é«˜åº¦ h = 0.60 mï¼Œä¿¯ä»°è§’ Î¸ = 29Â°ï¼ˆå‘ä¸‹ï¼‰
åƒç´ åº§æ¨™ (u, v) â†’ æ­¸ä¸€åŒ–åº§æ¨™ (x_norm, y_norm)
ç¸½ä¿¯ä»°è§’ total_pitch = Î¸ + arctan2(Î”v, fy)
å‰æ–¹è·é›¢ y_raw = h / tan(total_pitch)           â† å¹¾ä½•æŠ•å½±
æ©«å‘è·é›¢ x_raw = (h / sin(total_pitch)) * tan(Î±) â† æ–œè·æ³•
```

**è·é›¢æ ¡æ­£ä¿‚æ•¸ï¼ˆå¯¦æ¸¬æ¨™å®šï¼‰ï¼š**

- **å‚ç›´è·é›¢**ï¼šäºŒæ¬¡å¤šé …å¼æ ¡æ­£ `actual = -0.0921Â·dÂ² + 1.0379Â·d + 0.1030`
- **æ°´å¹³è·é›¢**ï¼šç·šæ€§æ ¡æ­£å› å­ `factor = -0.1613Â·y + 1.0051`

**æ„Ÿæ¸¬ç¯„åœï¼š**

| åƒæ•¸ | æ•¸å€¼ |
|------|------|
| æœ€è¿‘æ„Ÿæ¸¬è·é›¢ï¼ˆç›¸æ©Ÿï¼‰ | 0.45 m |
| æœ€é æ„Ÿæ¸¬è·é›¢ï¼ˆç›¸æ©Ÿï¼‰ | 3.25 m |
| åœæ­¢è·é›¢ | 1.04 m |
| æ©«å‘è¦–é‡å¯¬ï¼ˆåœæ­¢è·é›¢è™•ï¼‰| Â±0.6 m |

---

### 4.3 æ¨¡ç³Šæ§åˆ¶ç¯€é»

**æª”æ¡ˆï¼š** `scripts/mod_fuzzy_control4.py`  
**è¦å‰‡ï¼š** `src/fuzzy_control_design/fuzzy_rules_relaxed.csv`

è©³è¦‹ [ç¬¬ 5 ç« æ¨¡ç³Šæ§åˆ¶å™¨è¨­è¨ˆ](#5-æ¨¡ç³Šæ§åˆ¶å™¨è¨­è¨ˆ)ã€‚

**é—œéµè¡Œç‚ºï¼š**
- éµç›¤æ§åˆ¶ï¼ˆ`/avoidance_enabled`ï¼‰å„ªå…ˆæ–¼èªéŸ³æ§åˆ¶ï¼Œå…©è€…å‡å¯å•Ÿç”¨æ¨¡ç³Šæ¨è«–
- æ¨è«–æ™‚é–“çµ±è¨ˆè¼¸å‡ºè‡³ `outputs/fuzzy_stats_<timestamp>.txt`
- è¼¸å…¥è¼¸å‡ºè©³ç´°è¨˜éŒ„è‡³ `outputs/fuzzy_io_<timestamp>.csv`
- èªéŸ³æŒ‡ä»¤ `10000`ï¼ˆåœæ­¢ï¼‰æœƒåŒæ™‚æ¸…é™¤éµç›¤æ§åˆ¶æ¨™èªŒ

---

### 4.4 èªéŸ³æŒ‡ä»¤è™•ç†ç¯€é»

**æª”æ¡ˆï¼š** `scripts/mod_voice_processing4.py`  
**LLM Prompt è¨­å®šï¼š** `config/voice_llm_prompt_config.json`

**èªéŸ³è™•ç†å®Œæ•´æµç¨‹ï¼š**

```
è—ç‰™/USB éº¥å…‹é¢¨
    â”‚ PyAudio (16kHz, mono, chunk=1024)
    â–¼
VAD åµæ¸¬ (RMS é–¾å€¼, é è¨­ 1000)
    â”‚ é€£çºŒ 5 chunk > é–¾å€¼ â†’ é–‹å§‹éŒ„éŸ³
    â”‚ é€£çºŒ 10 chunk < é–¾å€¼ â†’ åœæ­¢ï¼ˆæœ€é•· 5 ç§’ï¼‰
    â–¼
WAV æš«å­˜ â†’ noisereduce é™å™ªï¼ˆå‰ 0.5 s ä½œç‚ºå™ªè²æ¨£æœ¬ï¼‰
    â–¼
pydub WAV â†’ MP3
    â–¼
base64 ç·¨ç¢¼ â†’ HTTPS POSTï¼ˆngrok tunnelï¼‰
    endpoint: /IAAgent/transcribe_translate
    {serviceid: 22, func: "amrr-001", conn: "ntnu-12345", invoice: "<base64>"}
    â–¼
JSON å›æ‡‰: {transcription: "...", inst_codes: ["11000"]}
    â–¼
é©—è­‰ 5 ä½æ•¸ç¢¼ + å†·å»æ™‚é–“ (1.0 s)
    â–¼
/voice_command_code (String)
```

**è‡ªå‹•è£ç½®åµæ¸¬ï¼š** å„ªå…ˆæœå°‹åç¨±å« `pulse` æˆ– `bluetooth` çš„è¼¸å…¥è£ç½®ï¼Œå¦å‰‡ä½¿ç”¨é è¨­ã€‚

**æ¸¬è©¦æ¨¡å¼ï¼ˆ`~test_mode: false`ï¼‰ï¼š** è¨­ç‚º `true` å¯ç”¨éµç›¤æ•¸å­— 0â€“9 æ¨¡æ“¬æŒ‡ä»¤ï¼Œç„¡éœ€éº¥å…‹é¢¨æˆ–ç¶²è·¯ã€‚

---

### 4.5 æ•´åˆæ§åˆ¶ç¯€é»

**æª”æ¡ˆï¼š** `scripts/integrated_control4.py`

**ä¸»å¾ªç’° 10Hzï¼Œä¸‰ç¨®é‹è¡Œç‹€æ…‹ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•´åˆæ§åˆ¶ä¸»å¾ªç’°                      â”‚
â”‚                                                      â”‚
â”‚  paused == True                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ä¸è¼¸å‡ºä»»ä½•é€Ÿåº¦ï¼ˆç­‰å¾…èªéŸ³å–šé†’ï¼‰              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â”‚  is_executing_voice_cmd && cmd_executing             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æŒ‰æŒ‡ä»¤é¡å‹åŸ·è¡Œï¼ˆè½‰å½/å‰é€²/å·¦å³è§€å¯Ÿï¼‰        â”‚   â”‚
â”‚  â”‚  è¶…æ™‚ä¿è­·ï¼šèªéŸ³æŒ‡ä»¤æœ€é•· 25 ç§’               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â”‚  avoidance å•Ÿç”¨ && !is_executing_voice_cmd           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  road_detected â†’ è½‰ç™¼ /fuzzy_cmd_vel          â”‚   â”‚
â”‚  â”‚  !road_detected â†’ stop_robot()               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŒ‡ä»¤å„ªå…ˆåºï¼š**  
`10000`ï¼ˆåœæ­¢ï¼‰> `21000`ï¼ˆå·¦å³è§€å¯Ÿï¼‰> `13xxx/14xxx`ï¼ˆè½‰å½ï¼‰> `11xxx/15xxx/16xxx`ï¼ˆå‰é€²/é¿éšœï¼‰> æ¨¡ç³Šæ§åˆ¶

**è½‰å½å¾Œå»¶é²æ©Ÿåˆ¶ï¼š** `15000`/`16000` å®Œæˆå¾Œï¼Œå»¶é² 1.5 ç§’å†å•Ÿå‹•æ¨¡ç³Šé¿éšœï¼Œé¿å…è½‰å½ç¬é–“èª¤åˆ¤ã€‚

**å·¦å³è§€å¯Ÿåºåˆ—ï¼ˆ21000ï¼Œå…± 8.35 sï¼‰ï¼š**

| æ™‚é–“æ®µ | å‹•ä½œ |
|--------|------|
| 0 â€“ 1.6 s | å·¦æ—‹ 90Â°ï¼ˆÏ‰ = +1.0 rad/sï¼‰|
| 1.6 â€“ 2.6 s | åœæ­¢æš«åœ |
| 2.6 â€“ 5.78 s | å³æ—‹ 180Â° |
| 5.78 â€“ 6.82 s | åœæ­¢æš«åœ |
| 6.82 â€“ 8.35 s | å·¦æ—‹ 90Â°ï¼ˆå›ä¸­ï¼‰|

---

### 4.6 è³‡æ–™è¨˜éŒ„ç¯€é»

**æª”æ¡ˆï¼š** `scripts/fuzzy_data_logger.py`

- ä»¥ 10Hz è¨‚é–±æ‰€æœ‰ç›¸é—œ topicsï¼ŒåŒæ­¥å¯«å…¥ CSV
- æ¬„ä½ï¼š`timestamp`, `datetime`, `road_detected`, `e_d`, `e_d_dot`, `e_l`, `e_l_dot`, `y_ground`, `x_ground`, `fuzzy_v`, `fuzzy_omega`, `cmd_v`, `cmd_omega`, `avoidance_enabled`, `system_status`
- é—œé–‰æ™‚ç”¢ç”Ÿ `.summary.txt`ï¼š`e_d`/`e_l` ç¯„åœçµ±è¨ˆã€`v`/`omega` æœ€å¤§å€¼ã€èª¿åƒå»ºè­°
- é è¨­è¼¸å‡ºï¼š`src/fuzzy_control_design/logs/fuzzy_data_<timestamp>.csv`

---

### 4.7 è³‡æºç›£æ§ç¯€é»

**æª”æ¡ˆï¼š** `scripts/resource_monitor_node.py`

- ä½¿ç”¨ `tegrastats`ï¼ˆJetson åŸç”Ÿå·¥å…·ï¼‰ä»¥ç²¾ç¢ºæ•æ‰ GPU è¨˜æ†¶é«”
- å•Ÿå‹•å‰è¨˜éŒ„**åŸºæº– RAM**ï¼Œå¾ŒçºŒä»¥å·®å€¼è¨ˆç®— App RAM å¢é‡ï¼ˆ`App_RAM_Used_MB = ç•¶å‰ - åŸºæº–`ï¼‰
- ç¯€é»é—œé–‰æ™‚ç”¢ç”Ÿ `_report.txt`ï¼Œå«å•Ÿå‹•å»¶é²ã€Peak/Avg CPUã€RAMã€GPU

**Launch åƒæ•¸ï¼š**

| åƒæ•¸ | é è¨­å€¼ | èªªæ˜ |
|------|--------|------|
| `~log_dir` | `outputs/resource_logs` | Log è¼¸å‡ºç›®éŒ„ |
| `~interval` | `1.0` s | tegrastats æ¡æ¨£é–“éš” |
| `~ready_delay` | `5.0` s | ç­‰å¾…å…¶ä»–ç¯€é»å•Ÿå‹•ï¼Œå†æ¨™è¨˜ç³»çµ±å°±ç·’ï¼ˆè¨ˆç®—å•Ÿå‹•å»¶é²ï¼‰|

**CSV æ¬„ä½ï¼š** `Timestamp`, `Time_Rel_Sec`, `CPU_Avg_Pct`, `CPU_Sum_Pct`, `GPU_Pct`, `RAM_Used_MB`, `App_RAM_Used_MB`, `RAM_Total_MB`, `SWAP_Used_MB`, `Temp_GPU_C`, `Temp_CPU_C`

---

## 5. æ¨¡ç³Šæ§åˆ¶å™¨è¨­è¨ˆ

### è¼¸å…¥è®Šæ•¸ï¼ˆ4 å€‹ï¼Œä¸‰è§’å½¢ / æ¢¯å½¢éš¸å±¬å‡½æ•¸ï¼‰

| è®Šæ•¸ | ç¯„åœ | èªè¨€å€¼ï¼ˆ5 ç´šï¼‰| èªªæ˜ |
|------|------|------------|------|
| `e_d` | `[0, 2.08]` m | VN / N / M / F / VF | å‰æ–¹é“è·¯è·é›¢èª¤å·®ï¼ˆ= å¯¦éš›è·é›¢ âˆ’ åœæ­¢è·é›¢ 1.04 mï¼‰|
| `e_d_dot` | `[-2.08, 2.08]` m/s | NB / NS / ZO / PS / PB | `e_d` è®ŠåŒ–ç‡ï¼ˆæ­£ = é é›¢ï¼Œè²  = é è¿‘ï¼‰|
| `e_l` | `[-0.5, 0.5]` m | NB / NS / ZO / PS / PB | æ©«å‘ä½ç½®èª¤å·®ï¼ˆå« Â±0.08 m æ­»å€ï¼Œå·¦è² å³æ­£ï¼‰|
| `e_l_dot` | `[-1.0, 1.0]` m/s | NB / NS / ZO / PS / PB | `e_l` è®ŠåŒ–ç‡ |

### è¼¸å‡ºè®Šæ•¸ï¼ˆ2 å€‹ï¼ŒSingleton è§£æ¨¡ç³ŠåŒ–ï¼‰

| è®Šæ•¸ | èªè¨€å€¼ | Singleton å€¼ |
|------|--------|-------------|
| `v`ï¼ˆç·šé€Ÿåº¦ï¼‰| S / VS / SL / M / F | 0 / 0.18 / 0.32 / 0.45 / 0.55 m/s |
| `omega`ï¼ˆè§’é€Ÿåº¦ï¼‰| NB / NS / ZO / PS / PB | âˆ’1.4 / âˆ’0.5 / 0 / +0.5 / +1.4 rad/s |

### æ¨è«–æµç¨‹

```
1. Fuzzification
   Î¼_e_d, Î¼_e_d_dot, Î¼_e_l, Î¼_e_l_dot â† triangular_mf()

2. Rule Evaluationï¼ˆå…± 625 æ¢ï¼ŒCSV è¼‰å…¥ï¼‰
   firing_strength = min(Î¼_e_d, Î¼_e_d_dot, Î¼_e_l, Î¼_e_l_dot)  â† Mamdani AND

3. Defuzzificationï¼ˆåŠ æ¬Šå¹³å‡æ³•ï¼‰
   v = Î£(firing_i Ã— v_singleton_i) / Î£(firing_i)
   omega = Î£(firing_i Ã— omega_singleton_i) / Î£(firing_i)

4. Post-processing
   v = clip(v, 0.0, 0.55)                  â† å®‰å…¨é™åˆ¶
   omega = clip(omega, -1.4, 1.4)
   v_out = Î±_v Ã— v + (1-Î±_v) Ã— v_prev      â† EMA ä½é€šæ¿¾æ³¢
   omega_out = Î±_Ï‰ Ã— omega + (1-Î±_Ï‰) Ã— omega_prev
   (Î±_v = 0.2ï¼ŒÎ±_Ï‰ = 0.3)
```

---

## 6. èªéŸ³æŒ‡ä»¤ç·¨ç¢¼ç³»çµ±

**æ ¼å¼ï¼š** `[è¨­å‚™ç¢¼ 1 ä½][å‹•ä½œç¢¼ 1 ä½][åƒæ•¸ç¢¼ 3 ä½]`ï¼ˆå…± 5 ä½æ•¸å­—ï¼‰  
**ç‰ˆæœ¬ï¼š** NSTC 114.12.19  
**è¨­å®šæª”ï¼š** `config/voice_llm_prompt_config.json`ï¼ˆLLM System Prompt èˆ‡ç¯„ä¾‹ï¼‰

### æŒ‡ä»¤ç¸½è¡¨

| è¨­å‚™ç¢¼ | è¨­å‚™ | å‹•ä½œç¢¼ | æŒ‡ä»¤ | èªªæ˜ |
|--------|------|--------|------|------|
| 1 | è¼‰å…·æ§åˆ¶ | 0 | `10000` | æš«åœ / åœæ­¢ |
| | | 1 | `11000` | å‰é€² / å•Ÿå‹•é¿éšœ |
| | | 2 | `12000` | ç¹¼çºŒå·¡é‚ |
| | | 3 | `13000` | å·¦è½‰ 90Â° |
| | | 3 | `131XX` | å·¦è½‰ XX åº¦ |
| | | 4 | `14000` | å³è½‰ 90Â° |
| | | 5 | `15000` | å·¦è½‰å¾Œå‰é€² |
| | | 6 | `16000` | å³è½‰å¾Œå‰é€² |
| | | 7 | `170XX` | æ’­æ”¾å½±ç‰‡ï¼ˆ01=å°±è¨ºæµç¨‹, 02=ç«ç½ç–æ•£ï¼‰|
| 2 | æ”å½±æ©Ÿ | 1 | `21000` | **é–‹å§‹ä»»å‹™**ï¼ˆå·¦å³è§€å¯Ÿ 8.35 sï¼‰|
| | | 2â€“6 | â€” | ä¸Šä¸‹/å·¦å³/ä¸Š/ä¸‹è§€å¯Ÿï¼ˆå¾…ç¡¬é«”æ•´åˆï¼‰|
| 3 | ä¸»æ©ŸåŠŸèƒ½ | 1â€“5 | â€” | å›å ±/æœå°‹/æ¸¬é‡/é ç´„/ç´€éŒ„ï¼ˆå¾…æ•´åˆï¼‰|
| 4 | åŸ·è¡Œè£ç½® | 1â€“5 | â€” | é–‹/é—œé–€ã€è§£/ä¸Šé–ã€æ‹¿çµ¦æˆ‘ï¼ˆå¾…æ•´åˆï¼‰|

### è§¸ç™¼èªéŸ³ç¯„ä¾‹

| èªéŸ³èªªæ³• | æŒ‡ä»¤ç¢¼ |
|---------|--------|
| ã€Œå‘å‰é€²ã€/ ã€Œå¾€å‰èµ°ã€ | `11000` |
| ã€Œåœä¸‹ä¾†ã€/ ã€Œæš«åœã€ | `10000` |
| ã€Œé–‹å§‹ä»»å‹™ã€/ ã€Œç’°é¡§å››å‘¨ã€ | `21000` |
| ã€Œå·¦è½‰ 45 åº¦ã€ | `13145` |
| ã€Œå³è½‰å¾Œå‰é€²åˆ°é›»æ¢¯ã€ | `16006` |
| ã€Œå‰é€² 10 å…¬å°ºã€ | `11110` |
| ã€Œæ‹¿æ°´çµ¦æˆ‘ã€ | `45001` |

---

## 7. ç›¸æ©Ÿåƒæ•¸èˆ‡æ¨™å®š

**è¨­å®šæª”ï¼š** `config/camera_config.yaml`

### ç›¸æ©Ÿå…§åƒï¼ˆå·²æ¨™å®šï¼‰

| åƒæ•¸ | æ•¸å€¼ |
|------|------|
| è§£æåº¦ | 640 Ã— 480 |
| fx / fy | 519.25 px |
| cx | 316.49 px |
| cy | 211.29 px |
| ç•¸è®Šä¿‚æ•¸ | `[-0.1059, 0.7790, 0.1938, -0.0095, -0.3831]` |

### ç›¸æ©Ÿå¤–åƒ

| åƒæ•¸ | æ•¸å€¼ |
|------|------|
| å®‰è£é«˜åº¦ | 0.60 mï¼ˆåœ°é¢åˆ°ç›¸æ©Ÿå…‰å¿ƒï¼‰|
| ä¿¯ä»°è§’ | 29Â°ï¼ˆå‘ä¸‹ï¼‰|
| ç›¸å°æ©Ÿå™¨äººå‰ç·£åç§» | âˆ’0.15 mï¼ˆå¾€å¾Œï¼‰|

### æ„Ÿæ¸¬ç¯„åœè¨­è¨ˆ

| åƒæ•¸ | æ•¸å€¼ |
|------|------|
| åœæ­¢è·é›¢ | 1.04 mï¼ˆå°æ‡‰ fuzzy `e_d = 0`ï¼‰|
| æ©«å‘è¦–é‡å¯¬ï¼ˆåœæ­¢è·é›¢è™•ï¼‰| 1.2 m |
| æœ€å°æ„Ÿæ¸¬è·é›¢ï¼ˆç›¸æ©Ÿï¼‰ | 0.45 m |
| æœ€å¤§æ„Ÿæ¸¬è·é›¢ï¼ˆç›¸æ©Ÿï¼‰ | 3.25 m |

---

## 8. å®‰è£èˆ‡ä¾è³´

### ç³»çµ±éœ€æ±‚

| é …ç›® | è¦æ ¼ |
|------|------|
| ç¡¬é«” | NVIDIA Jetson Orin NXï¼ˆæˆ–ç›¸å®¹ Jetson ç³»åˆ—ï¼‰|
| OS | Ubuntu 20.04 + JetPack 5.x |
| ROS | Noetic |
| CUDA / TensorRT | JetPack å…§å»º |

### Python ä¾è³´

```bash
# æ ¸å¿ƒ
pip install ultralytics          # YOLO11ï¼ˆå« TensorRT exportï¼‰
pip install opencv-python numpy pyyaml

# èªéŸ³è™•ç†
pip install pyaudio pydub soundfile noisereduce
pip install requests             # HTTP å‘¼å« LLM

# é¸ç”¨ï¼ˆè³‡æºç›£æ§ï¼‰
pip install psutil
```

> **æ³¨æ„ï¼š** `tegrastats` ç‚º JetPack é è£å·¥å…·ï¼Œé Python å¥—ä»¶ã€‚

### ROS å¥—ä»¶ä¾è³´ï¼ˆ`package.xml`ï¼‰

```
detection_msgs  roscpp  rospy  std_msgs  geometry_msgs
```

### YOLO11 TRT å¼•æ“

é è¨­è·¯å¾‘ï¼ˆç›¸å°å¥—ä»¶æ ¹ç›®éŒ„ï¼‰ï¼š
```
src/ultralytics/runs/segment/yolo11_seg_model12/weights/best.engine
```

å¦‚æ¨¡å‹è·¯å¾‘ä¸åŒï¼Œå¯åœ¨ launch ä¸­è¦†è“‹ï¼š
```xml
<param name="weights" value="/your/path/to/model.engine"/>
```

---

## 9. å•Ÿå‹•æ–¹å¼

### å®Œæ•´ç³»çµ±

```bash
cd ~/ros && source devel/setup.bash
roslaunch yolov7_ros integrated_system.launch
```

### å¸¸ç”¨å•Ÿå‹•é¸é …

```bash
# é—œé–‰è³‡æ–™è¨˜éŒ„ï¼ˆæ¸›å°‘ç£ç¢Ÿ I/Oï¼‰
roslaunch yolov7_ros integrated_system.launch enable_logger:=false

# é—œé–‰è³‡æºç›£æ§
roslaunch yolov7_ros integrated_system.launch enable_resource_monitor:=false

# å…©è€…çš†é—œï¼ˆæœ€å°ç³»çµ±ï¼‰
roslaunch yolov7_ros integrated_system.launch \
    enable_logger:=false \
    enable_resource_monitor:=false
```

### ç€è¦½ Launch ç¯€é»åƒæ•¸

```xml
<!-- integrated_system.launch é—œéµåƒæ•¸ -->
<param name="test_mode" value="false"/>          <!-- èªéŸ³ç¯€é»ï¼štrue=éµç›¤æ¨¡æ“¬ -->
<param name="log_dir"   value="$(find yolov7_ros)/outputs/resource_logs"/>
<param name="interval"  value="1.0"/>            <!-- è³‡æºç›£æ§æ¡æ¨£é–“éš” -->
<param name="ready_delay" value="5.0"/>          <!-- ç³»çµ±å°±ç·’ç­‰å¾…æ™‚é–“ -->
```

### éµç›¤æ§åˆ¶ï¼ˆè¦–çª—ç„¦é»åœ¨ `road_detection_node`ï¼‰

| æŒ‰éµ | åŠŸèƒ½ |
|------|------|
| `s` | åˆ‡æ›é¿éšœé–‹é—œ |
| `q` | é€€å‡ºç¯€é» |

### èªéŸ³æ¸¬è©¦æ¨¡å¼ï¼ˆç„¡éœ€éº¥å…‹é¢¨ï¼‰

åœ¨ launch æª”ä¸­å°‡ `test_mode` è¨­ç‚º `true`ï¼Œå†åŸ·è¡Œå¾Œæ–¼çµ‚ç«¯è¼¸å…¥æ•¸å­—ï¼š

| éµ | æŒ‡ä»¤ç¢¼ | å‹•ä½œ |
|----|--------|------|
| `0` | `10000` | åœæ­¢ |
| `1` | `21000` | é–‹å§‹ä»»å‹™ï¼ˆå·¦å³è§€å¯Ÿï¼‰|
| `2` | `11000` | å‰é€² / å•Ÿå‹•é¿éšœ |
| `3` | `13000` | å·¦è½‰ 90Â° |
| `4` | `14000` | å³è½‰ 90Â° |
| `5` | `15000` | å·¦è½‰å¾Œå‰é€² |
| `6` | `16000` | å³è½‰å¾Œå‰é€² |

---

## 10. è¼¸å‡ºæª”æ¡ˆçµæ§‹

```
outputs/
â”œâ”€â”€ fps_log_<timestamp>.txt               # YOLO æ¨è«– FPS è¨˜éŒ„ï¼ˆ5 ç§’é–“éš”ï¼‰
â”œâ”€â”€ fuzzy_stats_<timestamp>.txt           # æ¨¡ç³Šæ¨è«–æ™‚é–“çµ±è¨ˆï¼ˆmsï¼Œ5 ç§’é–“éš”ï¼‰
â”œâ”€â”€ fuzzy_io_<timestamp>.csv              # æ¨¡ç³Š I/Oï¼štimestamp,e_d,e_d_dot,e_l,e_l_dot,v,omega
â”œâ”€â”€ masks_<timestamp>/                    # åˆ†å‰²é®ç½©ï¼ˆåƒ… save_mask=true æ™‚ï¼‰
â”‚   â””â”€â”€ mask_000001.png
â”œâ”€â”€ detection_<timestamp>.avi             # åµæ¸¬å½±ç‰‡ï¼ˆåƒ… save_video=true æ™‚ï¼‰
â””â”€â”€ resource_logs/
    â””â”€â”€ <YYYYMMDD>/                       # æ¯å¤©ä¸€è³‡æ–™å¤¾
        â”œâ”€â”€ resources_<timestamp>.csv     # tegrastats åŸå§‹è³‡æ–™
        â””â”€â”€ resources_<timestamp>_report.txt   # æ‘˜è¦å ±å‘Š

src/fuzzy_control_design/logs/
â”œâ”€â”€ fuzzy_data_<timestamp>.csv            # fuzzy_data_logger å®Œæ•´è¨˜éŒ„
â””â”€â”€ fuzzy_data_<timestamp>.summary.txt    # çµ±è¨ˆæ‘˜è¦ + èª¿åƒå»ºè­°

recordings/
â”œâ”€â”€ recording_<timestamp>.wav             # åŸå§‹éŒ„éŸ³ï¼ˆVAD å¾Œï¼‰
â””â”€â”€ recording_<timestamp>.mp3             # å£“ç¸®å­˜æª”
```

---

## 11. èª¿åƒæŒ‡å¼•

### æ¨¡ç³Šæ§åˆ¶å™¨

| å•é¡Œ | å°ç­– | ä¿®æ”¹ä½ç½® |
|------|------|---------|
| è½‰å½éçŒ›ï¼ˆå·¦å³æ“ºå‹•ï¼‰| é™ä½ `OMEGA.NS/PS`ï¼ˆç›®å‰ Â±0.5ï¼‰| `MembershipFunctions.OMEGA` |
| è½‰å½ä¸è¶³ï¼ˆæ²¿ç‰†è¡Œèµ°ï¼‰| æé«˜ `OMEGA.NB/PB`ï¼ˆç›®å‰ Â±1.4ï¼‰| åŒä¸Š |
| é€Ÿåº¦éå¿« | é™ä½ `V.F`ï¼ˆç›®å‰ 0.55 m/sï¼‰| `MembershipFunctions.V` |
| ä½é€Ÿæ™‚ä»æŠ–å‹• | é™ä½ `alpha_omega`ï¼ˆç›®å‰ 0.3ï¼‰| `FuzzyController4Input.__init__` |
| `e_l` ç©©æ…‹èª¤å·®å¤§ | ç¸®å° `E_L.ZO` æ­»å€ï¼ˆç›®å‰ Â±0.08 mï¼‰| `MembershipFunctions.E_L` |
| è½‰å½å¾Œä¸ç¹¼çºŒé¿éšœ | èª¿æ•´ `TURN_AVOIDANCE_DELAY`ï¼ˆç›®å‰ 1.5 sï¼‰| `integrated_control4.py` |

### èªéŸ³éˆæ•åº¦

```bash
# å³æ™‚èª¿æ•´éœéŸ³é–¾å€¼ï¼ˆæ›´å¤§ = æ›´ä¸éˆæ•ï¼‰
rosparam set /voice_command_node/silence_threshold 1500

# å•Ÿç”¨éŸ³é‡åµéŒ¯ï¼ˆé¡¯ç¤ºå³æ™‚ RMSï¼‰
rosparam set /voice_command_node/debug_volume true
```

### BEV æ ¡æ­£

è‹¥æ›´æ›ç›¸æ©Ÿæˆ–æ”¹è®Šå®‰è£ä½ç½®ï¼Œéœ€é‡æ–°æ¨™å®šä¸¦æ›´æ–°ï¼š
1. `config/camera_config.yaml`ï¼šé‡æ–°å–å¾— `fx`, `fy`, `cx`, `cy`, `pitch_deg`, `height_m`
2. `mod_bev_transform.py` ä¸­çš„ `distance_correction_coeffs` å’Œ `lateral_correction_a/b`ï¼šé€éå¯¦éš›é‡æ¸¬é»åšå¤šé …å¼è¿´æ­¸

ä½¿ç”¨ `scripts/calibrate_camera.py` é€²è¡Œç›¸æ©Ÿå…§åƒæ¨™å®šï¼Œ`scripts/test_bev_visualization.py` é©—è­‰ BEV æŠ•å½±çµæœã€‚

---

## æˆæ¬Š

æœ¬å°ˆæ¡ˆç‚ºå­¸è¡“ç ”ç©¶ç”¨é€”ï¼ˆåœ‹ç§‘æœƒ NSTC è¨ˆç•«ï¼‰ï¼Œç¨‹å¼ç¢¼åƒ…ä¾›åƒè€ƒã€‚  
YOLO11 æ¨¡å‹éµå¾ª [Ultralytics AGPL-3.0](https://github.com/ultralytics/ultralytics/blob/main/LICENSE) æˆæ¬Šã€‚  
rf2o_laser_odometry éµå¾ªåŸä½œè€… [MAPIR Lab](http://mapir.isa.uma.es/work/rf2o) æˆæ¬Šæ¢æ¬¾ã€‚
