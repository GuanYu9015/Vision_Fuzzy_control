# 模糊規則設計表 v2.1

> **版本**：v2.1  
> **更新日期**：2026-01-08  
> **規則檔案**：`fuzzy_rules_relaxed.csv`  
> **規則數量**：625 條 (5×5×5×5)

---

## 1. 變數定義

### 1.1 輸入變數

| 變數 | 符號 | 模糊集合 | 範圍 | 說明 |
|------|------|----------|------|------|
| 前方距離誤差 | e_d | VN, N, M, F, VF | [0, 2.08] m | VN=很近, N=近, M=中, F=遠, VF=很遠 |
| 前方距離變化率 | e_d_dot | NB, NS, ZO, PS, PB | [-2.08, 2.08] | NB=快速接近, NS=慢速接近, ZO=不變, PS=慢速遠離, PB=快速遠離 |
| 橫向誤差 | e_l | NB, NS, ZO, PS, PB | [-0.5, 0.5] m | NB=左偏大, NS=左偏小, ZO=置中, PS=右偏小, PB=右偏大 |
| 橫向誤差變化率 | e_l_dot | NB, NS, ZO, PS, PB | [-1.0, 1.0] | NB=快速左偏, NS=慢速左偏, ZO=不變, PS=慢速右偏, PB=快速右偏 |

### 1.2 輸出變數

| 變數 | 符號 | 模糊集合 | 數值 | 說明 |
|------|------|----------|------|------|
| 線速度 | v | S, VS, SL, M, F | 0, 0.18, 0.32, 0.45, 0.55 m/s | 壓縮低速區間 |
| 角速度 | ω | NB, NS, ZO, PS, PB | -1.4, -0.5, 0, 0.5, 1.4 rad/s | 降低幅度減少擺動 |

---

## 2. 基準規則表

### 表 1A：線速度基準規則 (v)

> 只考慮前方距離 (e_d) 與距離變化率 (e_d_dot)

| e_d ＼ e_d_dot | NB (快速接近) | NS (慢速接近) | ZO (不變) | PS (慢速遠離) | PB (快速遠離) |
|:---:|:---:|:---:|:---:|:---:|:---:|
| **VN** (很近) | S | S | S | VS | VS |
| **N** (近) | S | VS | VS | SL | SL |
| **M** (中) | SL | SL | SL | M | F |
| **F** (遠) | SL | M | M | F | F |
| **VF** (很遠) | M | M | F | F | F |

---

### 表 1B：角速度基準規則 (ω)

> 只考慮橫向誤差 (e_l) 與橫向變化率 (e_l_dot)  
> **注意**：左偏 (e_l < 0) 需要右轉 (ω > 0) 修正

| e_l ＼ e_l_dot | NB (快速左偏) | NS (慢速左偏) | ZO (不變) | PS (慢速右偏) | PB (快速右偏) |
|:---:|:---:|:---:|:---:|:---:|:---:|
| **NB** (左偏大) | PB | PB | PB | PS | PS |
| **NS** (左偏小) | PB | PB | PS | PS | PS |
| **ZO** (置中) | PS | PS | ZO | NS | NS |
| **PS** (右偏小) | NS | NS | NS | NB | NB |
| **PB** (右偏大) | NS | NS | NB | NB | NB |

---

## 3. 交互作用修正規則

### 表 2A：線速度修正 (受橫向誤差 e_l 影響)

> 當機器人橫向偏移時，需要降低線速度以確保有足夠時間修正

| 橫向誤差 e_l | 線速度修正方式 |
|:---:|:---|
| **NB** (左偏大) | 降兩級，最低 S |
| **NS** (左偏小) | 降一級 |
| **ZO** (置中) | 不修正 |
| **PS** (右偏小) | 降一級 |
| **PB** (右偏大) | 降兩級，最低 S |

---

### 表 2B：角速度修正 (受前方距離 e_d 影響)

> 當距離很近時，減少角速度避免低速急轉造成擺動

| 前方距離 e_d | 角速度修正方式 |
|:---:|:---|
| **VN** (很近) | 減一級，最低 ZO |
| **N** (近) | 不修正 |
| **M** (中) | 不修正 |
| **F** (遠) | 不修正 |
| **VF** (很遠) | 不修正 |

---

## 4. 規則產生邏輯

### 4.1 演算法流程

```
對於每個 (e_d, e_d_dot, e_l, e_l_dot) 組合：
    1. 從表 1A 查詢線速度基準值 v_base
    2. 從表 1B 查詢角速度基準值 ω_base
    3. 根據表 2A 對 v_base 應用 e_l 修正 → v_final
    4. 根據表 2B 對 ω_base 應用 e_d 修正 → ω_final
    5. 輸出規則 (e_d, e_d_dot, e_l, e_l_dot) → (v_final, ω_final)
```

### 4.2 等級變更邏輯

- **降一級**：`S→S, VS→S, SL→VS, M→SL, F→M`
- **降兩級**：`S→S, VS→S, SL→S, M→VS, F→SL`
- **升一級**：`S→VS, VS→SL, SL→M, M→F, F→F`

---

## 5. 規則分佈統計

### 5.1 線速度分佈

| 輸出 | 數量 | 比例 |
|:---:|:---:|:---:|
| S (停止) | 240 | 38.4% |
| VS (極慢) | 130 | 20.8% |
| SL (慢速) | 140 | 22.4% |
| M (中速) | 85 | 13.6% |
| F (快速) | 30 | 4.8% |

### 5.2 角速度分佈

| 輸出 | 數量 | 比例 |
|:---:|:---:|:---:|
| NB (大右轉) | 100 | 16.0% |
| NS (小右轉) | 165 | 26.4% |
| ZO (直行) | 95 | 15.2% |
| PS (小左轉) | 165 | 26.4% |
| PB (大左轉) | 100 | 16.0% |

> **對稱性驗證**：左轉規則 265 條 = 右轉規則 265 條 ✓

---

## 6. 設計理念說明

### 6.1 表 2A 設計（線速度修正）

- **目的**：偏移時減速，確保有足夠時間修正軌跡
- **NB/PB 降兩級**：大偏移時必須大幅減速
- **NS/PS 降一級**：小偏移時適度減速，避免高速通過障礙

### 6.2 表 2B 設計（角速度修正）

- **目的**：避免低速急轉造成擺動
- **VN 減一級**：距離很近時線速度低，此時減少角速度，避免 ω/v 比例過高
- **其他不修正**：保持正常轉向能力

---

## 7. 版本歷史

| 版本 | 日期 | 變更內容 |
|------|------|----------|
| v1.0 | 2025-12-26 | 初始設計 |
| v2.0 | 2026-01-08 | 表 2A：NS/PS 也降一級；表 2B：F/VF 改為不修正 |
| v2.1 | 2026-01-08 | 表 2B：VN 從「加一級」改為「減一級」，解決低速擺動問題 |

---

## 8. 相關檔案

| 檔案 | 說明 |
|------|------|
| `generate_fuzzy_rules.py` | 根據本文件產生 625 條規則 |
| `fuzzy_rules_relaxed.csv` | 產生的規則 CSV 檔案 |
| `design.md` | 完整設計說明文件 |
| `membership_function_print.py` | 隸屬函數繪圖程式 |
